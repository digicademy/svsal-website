<VirtualHost *:80>
    ServerName          facs.salamanca.school
    ServerAdmin         admin@salamanca.school

    ErrorLog  /var/log/apache2/facs.salamanca.school-error.log
    CustomLog /var/log/apache2/facs.salamanca.school-access.log combined

    ProxyRequests       Off

    ProxyPass /.well-known !
    Alias /.well-known "/var/www/vhosts/.well-known"
    <Directory "/var/www/vhosts/.well-known">
        Require all granted
        AllowOverride All
        AddDefaultCharset Off
        Header set Content-Type "text/plain"
    </Directory>

    SSLProxyEngine on

    ProxyPass           /iiif/image/   https://c099-013.cloud.gwdg.de/digilib/Scaler/IIIF/svsal!
    ProxyPassReverse    /iiif/image/   https://c099-013.cloud.gwdg.de/digilib/Scaler/IIIF/svsal!
    ProxyPassReverse    /iiif/image/   https://c099-013.cloud.gwdg.de:8443/digilib/Scaler/IIIF/svsal!
    # ProxyPassReverse    /iiif/image/   http://c099-013.cloud.gwdg.de:8080/digilib/Scaler/IIIF/svsal!

    AddOutputFilterByType SUBSTITUTE application/json
    Substitute "s|https://c099-013.cloud.gwdg.de:8443/digilib/Scaler/IIIF/svsal!|https://facs.salamanca.school/iiif/image/|nq"
    Substitute "s|http://c099-013.cloud.gwdg.de:8080/digilib/Scaler/IIIF/svsal!|https://facs.salamanca.school/iiif/image/|nq"

    ProxyPass           /iiif/presentation/   http://localhost:8080/exist/apps/salamanca/
    ProxyPassReverse    /iiif/presentation/   https://localhost:8443/exist/apps/salamanca/
    # ProxyPassReverse    /iiif/presentation/   http://localhost:8080/exist/apps/salamanca/

    ProxyPass           /   https://c099-013.cloud.gwdg.de/svsal/
    ProxyPassReverse    /   https://c099-013.cloud.gwdg.de/svsal/

</VirtualHost>

<VirtualHost *:443>

    ServerName          facs.salamanca.school
    ServerAdmin         admin@salamanca.school

    ErrorLog  /var/log/apache2/facs.salamanca.school-error.log
    CustomLog /var/log/apache2/facs.salamanca.school-access.log combined

    ProxyRequests       Off

    SSLEngine on
SSLCertificateFile /etc/letsencrypt/live/salamanca.school/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/salamanca.school/privkey.pem

#    SSLProtocol all -SSLv3
#    SSLHonorCipherOrder On
#    SSLCipherSuite ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AM:RSA+AES:!aNULL:!MD5:!DSS
#    SSLCompression Off

    SSLProxyEngine on
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off

    ProxyPass           /iiif/image/  https://c099-013.cloud.gwdg.de/digilib/Scaler/IIIF/svsal!
    ProxyPassReverse    /iiif/image/  https://c099-013.cloud.gwdg.de/digilib/Scaler/IIIF/svsal!
    ProxyPassReverse    /iiif/image/  https://c099-013.cloud.gwdg.de:8443/digilib/Scaler/IIIF/svsal!
    # ProxyPassReverse    /iiif/image/  http://c099-013.cloud.gwdg.de:8080/digilib/Scaler/IIIF/svsal!

    AddOutputFilterByType SUBSTITUTE application/json
    Substitute "s|https://c099-013.cloud.gwdg.de:8443/digilib/Scaler/IIIF/svsal!|https://facs.salamanca.school/iiif/image/|nq"
    Substitute "s|http://c099-013.cloud.gwdg.de:8080/digilib/Scaler/IIIF/svsal!|https://facs.salamanca.school/iiif/image/|nq"

    # ProxyPass           /iiif/presentation/   http://localhost:8080/exist/apps/salamanca/
    ProxyPass           /iiif/presentation/   https://localhost:8443/exist/apps/salamanca/
    ProxyPassReverse    /iiif/presentation/   https://localhost:8443/exist/apps/salamanca/
    # ProxyPassReverse    /iiif/presentation/   http://localhost:8080/exist/apps/salamanca/

    ProxyPass           /   https://c099-013.cloud.gwdg.de/svsal/
    ProxyPassReverse    /   https://c099-013.cloud.gwdg.de/svsal/

</VirtualHost>
