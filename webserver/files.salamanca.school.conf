<VirtualHost *:80>
    ServerName          files.salamanca.school
    ServerAdmin         webmaster@salamanca.school

    ErrorLog  /var/log/apache2/files.salamanca.school-error.log
    CustomLog /var/log/apache2/files.salamanca.school-access.log combined

    ProxyRequests       Off                # We don't want to act as (open) forward proxy

    ProxyPass /.well-known !
    Alias /.well-known "/var/www/vhosts/.well-known"
    <Directory "/var/www/vhosts/.well-known">
        Require all granted
        AllowOverride All
        AddDefaultCharset Off
        Header set Content-Type "text/plain"
    </Directory>

    ProxyPass           /   http://127.0.0.1:8080/exist/apps/salamanca/
    ProxyPassReverse    /   http://127.0.0.1:8080/exist/apps/salamanca/
    ProxyPassReverse    /   https://127.0.0.1:8443/exist/apps/salamanca/
</VirtualHost>

<VirtualHost *:443>
    ServerName          files.salamanca.school
    ServerAdmin         webmaster@salamanca.school

    ErrorLog  /var/log/apache2/files.salamanca.school-error.log
    CustomLog /var/log/apache2/files.salamanca.school-access.log combined

    SSLEngine on
SSLCertificateFile /etc/letsencrypt/live/salamanca.school/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/salamanca.school/privkey.pem
    SSLProtocol all -SSLv3
    SSLHonorCipherOrder On
    SSLCipherSuite ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AE:RSA+AES:!aNULL:!MD5:!DSS
    SSLCompression Off

    ProxyRequests       Off                             # We don't want to act as (open) forward proxy
    ProxyPass           /   http://127.0.0.1:8080/exist/apps/salamanca/
    ProxyPassReverse    /   http://127.0.0.1:8080/exist/apps/salamanca/
    ProxyPassReverse    /   https://127.0.0.1:8443/exist/apps/salamanca/

    SSLProxyEngine On
    SSLProxyProtocol ALL -SSLv3
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off

</VirtualHost>

